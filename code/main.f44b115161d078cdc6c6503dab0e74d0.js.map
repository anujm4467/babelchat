{"version":3,"sources":["webpack:///./src/services/api.js","webpack:///./src/actions/types.js","webpack:///./src/actions/session.js","webpack:///./src/locales/index.js","webpack:///./src/locales/en.js","webpack:///./src/locales/es.js","webpack:///./src/services/firstInteraction.js","webpack:///./src/reducers/room.js","webpack:///./src/reducers/rooms.js","webpack:///./src/reducers/session.js","webpack:///./src/reducers/index.js","webpack:///./src/components/room/video.jsx","webpack:///./src/layout/session.jsx","webpack:///./src/layout/index.jsx","webpack:///./src/components/room/canvas.jsx","webpack:///./src/components/room/events.js","webpack:///./src/actions/room.js","webpack:///./src/components/room/peers.jsx","webpack:///./src/routes/room.jsx","webpack:///./src/routes/rooms.jsx","webpack:///./src/actions/rooms.js","webpack:///./src/components/ui/button.js","webpack:///./src/routes/login.jsx","webpack:///./src/routes/404.jsx","webpack:///./src/routes/index.jsx","webpack:///./src/index.jsx"],"names":["api","API","_classCallCheck","this","baseURL","__API__","body","_ref","endpoint","_ref$headers","headers","_ref$method","method","authorization","Authorization","FormData","JSON","stringify","fetch","concat","then","res","status","Error","get","split","arrayBuffer","json","token","SESSION_REFRESH_FULFILLED","SESSION_REFRESH_REJECTED","SESSION_SIGNOUT","ROOM_ADD_PHOTO","ROOM_JOIN","ROOM_PEER_JOIN","ROOM_PEER_LEAVE","ROOM_PEER_SIGNAL","ROOM_PEER_STREAM","ROOM_MOVE_PHOTO","ROOM_REMOVE_PHOTO","ROOM_RESET","ROOM_STREAM_START","refresh","session","type","types","payload","dispatch","catch","locales","en","NotFound","defaultRoute","goBack","Room","joining","welcome","Rooms","peers","peers_1","User","signIn","signOut","es","availableLocales","Object","keys","translations","forEach","locale","merge","firstInteraction","FirstInteraction","firstInteraction_classCallCheck","promises","getPromise","bind","onKey","onPointer","touches","Touches","window","filtered","preventSimulated","on","addEventListener","isReady","Promise","resolve","push","disable","removeEventListener","onFirstInteraction","roomReducer","combineReducers","name","state","arguments","length","undefined","action","connection","destroy","room_toConsumableArray","peer","filter","_ref2","_ref3","signal","map","video","document","createElement","srcObject","stream","onloadedmetadata","WaitForFirstInteraction","play","_objectSpread","_ref4","addStream","_ref5","photos","photo","_id","origin","x","y","_ref6","socket","getTracks","track","stop","muted","roomsReducer","list","sort","a","b","localeCompare","sessionKey","storedSession","parse","localStorage","getItem","setAuthorization","sessionReducer","isAuth","profile","setItem","removeItem","rootReducer","i18n","loadingBar","room","rooms","Video","props","_this","video_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","call","dom","React","createRef","Component","current","appendChild","react_default","ref","propTypes","PropTypes","object","isRequired","Wrapper","styled","div","withConfig","displayName","componentId","Session","signout","className","getVideoTracks","components_room_video","alt","src","onClick","react_redux_i18n_build","value","bool","shape","string","oneOfType","func","connect","_ref2$session","Route","loadingBarStyle","backgroundColor","Layout","children","build_default","style","layout_session","layout_Route","node","Canvas","canvas_classCallCheck","canvas_getPrototypeOf","onDrop","canvas_assertThisInitialized","onPointerWheel","onResize","scale","e","preventDefault","canvas","loadPhotos","onDragOver","onPointerStart","onPointerMove","onPointerEnd","addWheelListener","draw","removeWheelListener","clientX","clientY","file","_slicedToArray","dataTransfer","files","getPointer","reader","FileReader","onload","send","result","substr","indexOf","readAsDataURL","pointer","_this2","_this$props","button","_this$getPointer","intersects","image","width","height","reverse","dragging","shiftKey","offset","_this$getPointer2","_dragging$photo","deltaY","normalized","Math","min","max","innerWidth","innerHeight","_this3","img","Image","_this4","_ref7","ctx","getContext","translate","textAlign","textBaseline","fillStyle","font","fillText","I18n","t","_ref8","drawImage","arrayOf","number","_ref9","_ref9$room","Events","events_classCallCheck","events_getPrototypeOf","onMessage","events_assertThisInitialized","slug","hideLoading","showLoading","startStream","WebSocket","replace","onopen","onclose","onerror","onmessage","navigator","mediaDevices","getUserMedia","audio","facingMode","_this$props2","reset","readyState","CONNECTING","close","event","data","_this$props3","addPhoto","join","movePhoto","peerJoin","peerLeave","peerSignal","removePhoto","events_objectSpread","connectToPeer","initiator","_this$props4","peerStream","Peer","Listing","Peers","key","match","params","room_canvas","events","components_room_peers","PureComponent","rooms_Listing","Link","to","pathname","count","primary","Box","Login","login_classCallCheck","login_getPrototypeOf","loginWithGoogle","login_assertThisInitialized","popupWatcher","clearInterval","screenX","screenY","left","screen","w","top","h","win","open","setInterval","postMessage","login_Wrapper","ui_button","ti","Status","Description","Alternative","location","from","_404_Wrapper","route","store","storedLocale","browserLocale","history","component","requiresAuth","requiresNoAuth","rest","_objectWithoutProperties","isForbidden","_extends","render","Redirect","Root","layout","Switch","exact","routes_Route","path","compose","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","productionCompose","createStore","applyMiddleware","thunkMiddleware","promiseMiddleware","loadingBarMiddleware","languages","language","browserLanguage","userLanguage","toLowerCase","syncTranslationWithStore","loadTranslations","setLocale","getState","refreshToken","process","createHashHistory","createBrowserHistory","basename","__BASENAME__","mount","getElementById","react_redux_es","Router","routes"],"mappings":"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","file":"code/main.d7b76c751b479ce73c7b.js","sourcesContent":["class API {\n  constructor() {\n    this.baseURL = __API__;\n  }\n\n  fetch({\n    body,\n    endpoint,\n    headers = {},\n    method = 'GET',\n  }) {\n    const {\n      authorization,\n      baseURL,\n    } = this;\n    if (authorization) {\n      headers.Authorization = authorization;\n    }\n    if (body && !(body instanceof FormData)) {\n      body = JSON.stringify(body);\n      headers['Content-Type'] = 'application/json';\n    }\n    return fetch(\n      `${baseURL}${endpoint}`,\n      {\n        body,\n        headers,\n        method,\n      }\n    )\n      .then((res) => {\n        const { headers, status } = res;\n        if (status < 200 || status >= 400) {\n          throw new Error(status);\n        }\n        const type = (headers.get('Content-Type') || '').split(';')[0];\n        switch (type) {\n          case 'text/plain':\n            return res.arrayBuffer();\n          case 'application/json':\n            return res.json();\n          default:\n            return res;\n        }\n      });\n  }\n\n  setAuthorization(token) {\n    if (token) {\n      this.authorization = `Bearer ${token}`;\n    } else {\n      delete this.authorization;\n    }\n    this.token = token;\n  }\n}\n\nexport default new API();\n","export const SESSION_REFRESH = 'SESSION/REFRESH';\nexport const SESSION_REFRESH_FULFILLED = 'SESSION/REFRESH_FULFILLED';\nexport const SESSION_REFRESH_REJECTED = 'SESSION/REFRESH_REJECTED';\nexport const SESSION_SIGNOUT = 'SESSION/SIGNOUT';\nexport const ROOM_ADD_PHOTO = 'ROOM/ADD_PHOTO';\nexport const ROOM_JOIN = 'ROOM/JOIN';\nexport const ROOM_PEER_JOIN = 'ROOM/PEER_JOIN';\nexport const ROOM_PEER_LEAVE = 'ROOM/PEER_LEAVE';\nexport const ROOM_PEER_SIGNAL = 'ROOM/PEER_SIGNAL';\nexport const ROOM_PEER_STREAM = 'ROOM/PEER_STREAM';\nexport const ROOM_MOVE_PHOTO = 'ROOM/MOVE_PHOTO';\nexport const ROOM_REMOVE_PHOTO = 'ROOM/REMOVE_PHOTO';\nexport const ROOM_RESET = 'ROOM/RESET';\nexport const ROOM_STREAM_START = 'ROOM/STREAM_START';\nexport const ROOMS_FETCH = 'ROOMS/FETCH';\nexport const ROOMS_FETCH_FULFILLED = 'ROOMS/FETCH_FULFILLED';\n","import { setLocale as reduxSetLocale } from 'react-redux-i18n';\nimport API from '@/services/api';\nimport * as types from './types';\n\nexport function refresh(session) {\n  if (session) {\n    return {\n      type: types.SESSION_REFRESH_FULFILLED,\n      payload: session,\n    };\n  }\n  return dispatch => dispatch({\n    type: types.SESSION_REFRESH,\n    payload: API.fetch({\n      endpoint: 'user',\n    }),\n  }).catch(() => {});\n}\n\nexport function setLocale(locale) {\n  return (dispatch) => {\n    localStorage.setItem('BABELCHAT::LOCALE', locale);\n    dispatch(reduxSetLocale(locale));\n  };\n}\n\nexport function signout() {\n  return {\n    type: types.SESSION_SIGNOUT,\n  };\n}\n","import diff from 'deep-diff';\nimport { recursive as merge } from 'merge';\nimport { loadTranslations, setLocale, syncTranslationWithStore } from 'react-redux-i18n';\nimport en from './en';\nimport es from './es';\n\nconst locales = {\n  en,\n  es,\n};\nconst availableLocales = Object.keys(locales);\nconst defaultLocale = 'en';\n\n// Populate locales with default literals\nconst translations = {};\navailableLocales.forEach((locale) => {\n  translations[locale] = merge(true, locales[defaultLocale], locales[locale]);\n});\n\n// Translations loader handler (for hot-reloading)\nexport const load = (store) => {\n  store.dispatch(loadTranslations(translations));\n};\n\nexport default (store) => {\n  // Locale Autodetection\n  const storedLocale = localStorage.getItem('BABELCHAT::LOCALE');\n  const browserLocale = (\n    (window.navigator.languages ? window.navigator.languages[0] : null)\n    || window.navigator.language\n    || window.navigator.browserLanguage\n    || window.navigator.userLanguage\n    || defaultLocale\n  ).substr(0, 2).toLowerCase();\n\n  let locale = defaultLocale;\n  if (~availableLocales.indexOf(storedLocale)) locale = storedLocale;\n  else if (~availableLocales.indexOf(browserLocale)) locale = browserLocale;\n\n  // Setup react-i18nify\n  syncTranslationWithStore(store);\n  load(store);\n  store.dispatch(setLocale(locale));\n\n  if (!__PRODUCTION__) {\n    // Warn about missing translations\n    const missing = availableLocales\n      .reduce((missing, locale) => {\n        if (locale === defaultLocale) {\n          return missing;\n        }\n        const keys = diff(locales[defaultLocale], locales[locale])\n          .reduce((missing, { kind, path }) => {\n            if (kind === 'E') {\n              return missing;\n            }\n            return [\n              ...missing,\n              path.join('.'),\n            ];\n          }, []);\n        if (!keys.length) {\n          return missing;\n        }\n        return [\n          ...missing,\n          `\\nMissing translations for \"${locale.toUpperCase()}\" locale:`,\n          ...keys,\n        ];\n      }, []);\n    if (missing.length) {\n      console.warn(missing.join('\\n'));\n    }\n  }\n};\n","export default {\n  NotFound: {\n    defaultRoute: 'This is not the web page you\\'re looking for.',\n    goBack: 'Take me back home',\n  },\n  Room: {\n    joining: 'Joining room...',\n    welcome: 'Welcome to: \"%{name}\"',\n  },\n  Rooms: {\n    peers: '%{count} peers',\n    peers_1: '%{count} peer',\n  },\n  User: {\n    signIn: 'Sign-In',\n    signOut: 'Sign-Out',\n  },\n};\n","export default {\n  NotFound: {\n    defaultRoute: 'Esta no es la página que estás buscando.',\n    goBack: 'Vplver al inicio',\n  },\n  Room: {\n    joining: 'Entrando en la habitación...',\n    welcome: 'Bienvenido a: \"%{name}\"',\n  },\n  Rooms: {\n    peers: '%{count} personas',\n    peers_1: '%{count} persona',\n  },\n  User: {\n    signIn: 'Iniciar Sesión',\n    signOut: 'Cerrar Sesión',\n  },\n};\n","\nimport Touches from 'touches';\n\nclass FirstInteraction {\n  constructor() {\n    this.promises = [];\n    this.getPromise = this.getPromise.bind(this);\n    this.onKey = this.onKey.bind(this);\n    this.onPointer = this.onPointer.bind(this);\n    this.touches = Touches(window, {\n      filtered: true,\n      preventSimulated: false,\n    }).on('start', this.onPointer).on('end', this.onPointer);\n    window.addEventListener('keydown', this.onKey, false);\n    window.addEventListener('keyup', this.onKey, false);\n  }\n\n  getPromise() {\n    const { isReady, promises } = this;\n    return new Promise((resolve) => {\n      if (isReady) {\n        resolve();\n        return;\n      }\n      promises.push(resolve);\n    });\n  }\n\n  onFirstInteraction() {\n    const { promises, touches } = this;\n    touches.disable();\n    window.removeEventListener('keydown', this.onKey);\n    window.removeEventListener('keyup', this.onKey);\n    this.isReady = true;\n    promises.forEach(resolve => resolve());\n  }\n\n  onKey() {\n    this.onFirstInteraction();\n  }\n\n  onPointer() {\n    this.onFirstInteraction();\n  }\n}\n\nexport default (new FirstInteraction()).getPromise;\n","import { combineReducers } from 'redux';\nimport * as types from '@/actions/types';\nimport WaitForFirstInteraction from '@/services/firstInteraction';\n\nconst name = (\n  state = '',\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_JOIN:\n      return action.payload.name;\n    case types.ROOM_RESET:\n      return '';\n    default:\n      return state;\n  }\n};\n\nconst peers = (\n  state = [],\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_JOIN:\n      state.forEach(({ connection }) => (\n        connection.destroy()\n      ));\n      return action.payload.peers;\n    case types.ROOM_PEER_JOIN:\n      return [\n        ...state,\n        action.payload.peer,\n      ];\n    case types.ROOM_PEER_LEAVE:\n      return state.filter(\n        ({ connection, peer }) => {\n          if (peer === action.payload.peer) {\n            connection.destroy();\n            return true;\n          }\n          return false;\n        }\n      );\n    case types.ROOM_PEER_SIGNAL:\n      state.forEach(({ connection, peer }) => {\n        if (peer === action.payload.peer) {\n          connection.signal(action.payload.signal);\n        }\n      });\n      return state;\n    case types.ROOM_PEER_STREAM:\n      return state.map(\n        (peer) => {\n          if (peer.peer === action.payload.peer) {\n            const video = document.createElement('video');\n            video.srcObject = action.payload.stream;\n            video.onloadedmetadata = () => (\n              WaitForFirstInteraction()\n                .then(() => video.play())\n            );\n            return {\n              ...peer,\n              video,\n            };\n          }\n          return peer;\n        }\n      );\n    case types.ROOM_STREAM_START:\n      state.forEach(({ connection }) => {\n        connection.addStream(action.payload.stream);\n      });\n      return state;\n    case types.ROOM_RESET:\n      state.forEach(({ connection }) => (\n        connection.destroy()\n      ));\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst photos = (\n  state = [],\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_JOIN:\n      return action.payload.photos;\n    case types.ROOM_ADD_PHOTO:\n      return [\n        ...state,\n        action.payload,\n      ];\n    case types.ROOM_MOVE_PHOTO:\n      return state.map((photo) => {\n        if (photo._id === action.payload.photo) {\n          return {\n            ...photo,\n            origin: {\n              x: action.payload.origin.x,\n              y: action.payload.origin.y,\n            },\n          };\n        }\n        return photo;\n      });\n    case types.ROOM_REMOVE_PHOTO:\n      return state.filter(({ _id }) => (_id !== action.payload.photo));\n    case types.ROOM_RESET:\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst socket = (\n  state = false,\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_JOIN:\n      return action.payload.socket;\n    case types.ROOM_RESET:\n      return false;\n    default:\n      return state;\n  }\n};\n\nconst stream = (\n  state = false,\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_STREAM_START:\n      return action.payload.stream;\n    case types.ROOM_RESET:\n      if (state) {\n        state.getTracks().forEach(track => track.stop());\n      }\n      return false;\n    default:\n      return state;\n  }\n};\n\nconst video = (\n  state = false,\n  action\n) => {\n  switch (action.type) {\n    case types.ROOM_STREAM_START: {\n      const video = document.createElement('video');\n      video.muted = true;\n      video.srcObject = action.payload.stream;\n      video.onloadedmetadata = () => (\n        WaitForFirstInteraction()\n          .then(() => video.play())\n      );\n      return video;\n    }\n    case types.ROOM_RESET:\n      if (state) {\n        state.srcObject = null;\n      }\n      return false;\n    default:\n      return state;\n  }\n};\n\nconst roomReducer = combineReducers({\n  name,\n  peers,\n  photos,\n  socket,\n  stream,\n  video,\n});\n\nexport default roomReducer;\n","import { combineReducers } from 'redux';\nimport * as types from '@/actions/types';\n\nconst list = (\n  state = [],\n  action\n) => {\n  switch (action.type) {\n    case types.ROOMS_FETCH_FULFILLED:\n      return action.payload.sort(({ name: a }, { name: b }) => a.localeCompare(b));\n    default:\n      return state;\n  }\n};\n\nconst roomsReducer = combineReducers({\n  list,\n});\n\nexport default roomsReducer;\n","import { combineReducers } from 'redux';\nimport * as types from '@/actions/types';\nimport API from '@/services/api';\n\nconst sessionKey = 'BABELCHAT::SESSION';\nconst storedSession = JSON.parse(\n  localStorage.getItem(sessionKey) || 'false'\n);\nif (storedSession) {\n  API.setAuthorization(storedSession.token);\n}\n\nconst isAuth = (\n  state = !!storedSession,\n  action\n) => {\n  switch (action.type) {\n    case types.SESSION_REFRESH_FULFILLED:\n      return true;\n    case types.SESSION_REFRESH_REJECTED:\n    case types.SESSION_SIGNOUT:\n      return false;\n    default:\n      return state;\n  }\n};\n\nconst profile = (\n  state = storedSession ? storedSession.profile : {},\n  action\n) => {\n  switch (action.type) {\n    case types.SESSION_REFRESH_FULFILLED:\n      return action.payload.profile;\n    case types.SESSION_REFRESH_REJECTED:\n    case types.SESSION_SIGNOUT:\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst token = (\n  state = storedSession ? storedSession.token : '',\n  action\n) => {\n  switch (action.type) {\n    case types.SESSION_REFRESH_FULFILLED:\n      API.setAuthorization(action.payload.token);\n      localStorage.setItem(sessionKey, JSON.stringify(action.payload));\n      return action.payload.token;\n    case types.SESSION_REFRESH_REJECTED:\n    case types.SESSION_SIGNOUT:\n      API.setAuthorization(false);\n      localStorage.removeItem(sessionKey);\n      return '';\n    default:\n      return state;\n  }\n};\n\nconst sessionReducer = combineReducers({\n  isAuth,\n  profile,\n  token,\n});\n\nexport default sessionReducer;\n","import { combineReducers } from 'redux';\nimport { i18nReducer as i18n } from 'react-redux-i18n';\nimport { loadingBarReducer as loadingBar } from 'react-redux-loading-bar';\nimport room from './room';\nimport rooms from './rooms';\nimport session from './session';\n\nconst rootReducer = combineReducers({\n  i18n,\n  loadingBar,\n  room,\n  rooms,\n  session,\n});\n\nexport default rootReducer;\n","import PropTypes from 'prop-types';\nimport React, { Component } from 'react';\n\nclass Video extends Component {\n  constructor(props) {\n    super(props);\n    this.dom = React.createRef();\n  }\n\n  componentDidMount() {\n    const { dom } = this;\n    const { video } = this.props;\n    dom.current.appendChild(video);\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  render() {\n    const { dom } = this;\n    return (\n      <div ref={dom} />\n    );\n  }\n}\n\nVideo.propTypes = {\n  // eslint-disable-next-line react/forbid-prop-types\n  video: PropTypes.object.isRequired,\n};\n\nexport default Video;\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Translate } from 'react-redux-i18n';\nimport styled from 'styled-components';\nimport { signout } from '@/actions/session';\nimport API from '@/services/api';\nimport Video from '@/components/room/video';\n\nconst Wrapper = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  .toggle {\n    > img, > div > video {\n      background: #000;\n      width: 100px;\n      height: 100px;\n      vertical-align: middle;\n      box-shadow: 0 0 10px rgba(0, 0, 0, .5);\n    }\n  }\n  .menu {\n    display: none;\n    position: absolute;\n    top: 100%;\n    right: 0;\n    background: #eee;\n    border: 1px solid #000;\n    box-shadow: 0 0 10px rgba(0, 0, 0, .5);\n    z-index: 1;\n    > a, > span {\n      display: block;\n      padding: 0.5rem 1rem;\n      white-space: nowrap;\n    }\n    > span {\n      color: #bebebe;\n      border-bottom: 1px solid #bebebe;\n    }\n    > a {\n      text-decoration: none;\n      cursor: pointer;\n    }\n  }\n  &:hover .menu {\n    display: block;\n  }\n`;\n\nconst Session = ({\n  isAuth,\n  profile,\n  video,\n  signout,\n}) => (\n  isAuth ? (\n    <Wrapper>\n      <div className=\"toggle\">\n        {video && video.srcObject.getVideoTracks().length ? (\n          <Video\n            video={video}\n          />\n        ) : (\n          <img\n            alt={profile.name}\n            src={`${API.baseURL}user/${profile._id}/photo?auth=${API.token}`}\n          />\n        )}\n      </div>\n      <div className=\"menu\">\n        <span>{profile.name}</span>\n        <a onClick={signout}>\n          <Translate value=\"User.signOut\" />\n        </a>\n      </div>\n    </Wrapper>\n  ) : null\n);\n\nSession.propTypes = {\n  isAuth: PropTypes.bool.isRequired,\n  profile: PropTypes.shape({\n    _id: PropTypes.string,\n    name: PropTypes.string,\n  }).isRequired,\n  video: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]).isRequired,\n  signout: PropTypes.func.isRequired,\n};\n\nexport default connect(\n  ({\n    session: { isAuth, profile },\n    room: { video },\n  }) => ({\n    isAuth,\n    profile,\n    video,\n  }),\n  {\n    signout,\n  }\n)(Session);\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport LoadingBar from 'react-redux-loading-bar';\nimport styled from 'styled-components';\nimport Session from './session';\n\nconst Route = styled.div`\n  display: flex;\n  height: 100vh;\n`;\n\nconst loadingBarStyle = {\n  backgroundColor: '#bebebe',\n};\n\nconst Layout = ({ children }) => (\n  <div>\n    <LoadingBar style={loadingBarStyle} />\n    <Session />\n    <Route>\n      { children }\n    </Route>\n  </div>\n);\n\nLayout.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default Layout;\n","import PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport { I18n } from 'react-redux-i18n';\nimport { connect } from 'react-redux';\nimport Touches from 'touches';\nimport { addWheelListener, removeWheelListener } from 'wheel';\n\nclass Canvas extends Component {\n  constructor(props) {\n    super(props);\n    this.dom = React.createRef();\n    this.onDrop = this.onDrop.bind(this);\n    this.onPointerWheel = this.onPointerWheel.bind(this);\n    this.onResize = this.onResize.bind(this);\n    // This is what controls the viewport translation\n    this.origin = { x: 0, y: 0 };\n    // This is what controls the viewport scaling\n    this.scale = 1;\n    // The photos in the state are stored as a base64 string\n    // We need to load the as Image objects in order to call ctx.drawImage\n    // (and also to extract their width & height for intersection testing)\n    // This is where we cache the loaded Image objects\n    this.photos = {};\n  }\n\n  componentDidMount() {\n    const { dom: { current: canvas } } = this;\n    // Load the inital set of photos\n    this.loadPhotos(this.props);\n    // Bind the events\n    canvas.addEventListener('dragover', Canvas.onDragOver, false);\n    canvas.addEventListener('drop', this.onDrop, false);\n    window.addEventListener('resize', this.onResize, false);\n    this.touches = Touches(window, {\n      filtered: true,\n      preventSimulated: false,\n    })\n      .on('start', this.onPointerStart.bind(this))\n      .on('move', this.onPointerMove.bind(this))\n      .on('end', this.onPointerEnd.bind(this));\n    addWheelListener(window, this.onPointerWheel);\n    // Initial resize (this will also call the initial draw)\n    this.onResize();\n  }\n\n  componentWillReceiveProps(props) {\n    // The redux state has changed...\n    // Load photos as Image objects and store them in the cache\n    this.loadPhotos(props);\n    // Redraw\n    this.draw(props);\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  componentWillUnmount() {\n    const { dom: { current: canvas }, touches } = this;\n    // We're unloading the room\n    // Unbind all event handlers\n    touches.disable();\n    canvas.removeEventListener('dragover', Canvas.onDragOver);\n    canvas.removeEventListener('drop', this.onDrop);\n    removeWheelListener(window, this.onPointerWheel);\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  static onDragOver(e) {\n    e.preventDefault();\n  }\n\n  onDrop(e) {\n    // The user dropped a file into the canvas\n    const { socket } = this.props;\n    const {\n      clientX,\n      clientY,\n      dataTransfer: { files: [file] },\n    } = e;\n    e.preventDefault();\n    // We're only interested in files\n    if (!file) {\n      return;\n    }\n    // Get the screen-space pointer in room-space\n    const origin = this.getPointer([clientX, clientY]);\n    // Read the file\n    const reader = new FileReader();\n    reader.onload = () => {\n      // Once it loads, send it to the room server:\n      socket.send(JSON.stringify({\n        type: 'ROOM/ADD_PHOTO',\n        payload: {\n          origin,\n          photo: reader.result.substr(reader.result.indexOf('base64') + 7),\n        },\n      }));\n    };\n    reader.readAsDataURL(file);\n  }\n\n  onPointerStart(e, pointer) {\n    const { photos, socket } = this.props;\n    const button = e.button || 0;\n    const { x, y } = this.getPointer(pointer);\n\n    // Get photo at pointer\n    const intersects = photos\n      .filter(({ _id, origin }) => {\n        const image = this.photos[_id];\n        // Filter it out if it hasn't been loaded\n        // yet into the cache as an Image object\n        if (!image) {\n          return false;\n        }\n        const { width, height } = image;\n        if (\n          x < origin.x\n          || x > origin.x + width\n          || y < origin.y\n          || y > origin.y + height\n        ) {\n          // The pointer is outside the bounds\n          return false;\n        }\n        // We got a hit!\n        return true;\n      });\n    // Reverse the filtered photos to get\n    // the one renderded on top first\n    intersects.reverse();\n    const photo = intersects[0];\n\n    if (\n      // Clicking the canvas (or right click)\n      // will drag it's origin\n      (button === 0 && !photo)\n      || (button === 2)\n    ) {\n      this.dragging = {\n        canvas: pointer,\n      };\n    } else if (\n      // Left click drags/removes photos\n      button === 0 && photo\n    ) {\n      if (e.shiftKey) {\n        // Shift+Click will remove the photo\n        socket.send(JSON.stringify({\n          type: 'ROOM/REMOVE_PHOTO',\n          payload: {\n            photo: photo._id,\n          },\n        }));\n      } else {\n        // Left click will drag the photo\n        this.dragging = {\n          offset: {\n            x: photo.origin.x - x,\n            y: photo.origin.y - y,\n          },\n          photo,\n        };\n      }\n    }\n  }\n\n  onPointerMove(e, pointer) {\n    const { dragging, origin, scale } = this;\n    if (!dragging) {\n      return;\n    }\n    if (dragging.canvas) {\n      // Translate the canvas origin\n      origin.x += (pointer[0] - dragging.canvas[0]) / scale;\n      origin.y += (pointer[1] - dragging.canvas[1]) / scale;\n      dragging.canvas = pointer;\n    }\n    if (dragging.photo) {\n      // Translate the photo\n      const { offset, photo } = dragging;\n      const { x, y } = this.getPointer(pointer);\n      photo.origin.x = x + offset.x;\n      photo.origin.y = y + offset.y;\n    }\n    // Redraw\n    this.draw();\n  }\n\n  onPointerEnd() {\n    const { dragging } = this;\n    const { socket } = this.props;\n    if (!dragging) {\n      return;\n    }\n    delete this.dragging;\n    if (dragging.photo) {\n      // Send the final translation to the server\n      // So it gets saved into the db and broadcasted to the peers\n      const { _id: photo, origin } = dragging.photo;\n      socket.send(JSON.stringify({\n        type: 'ROOM/MOVE_PHOTO',\n        payload: {\n          origin,\n          photo,\n        },\n      }));\n    }\n  }\n\n  onPointerWheel({ deltaY }) {\n    // Zoom the canvas in and out when the mouse wheel moves\n    const normalized = 1 + (Math.min(Math.max(-deltaY, -1), 1) * 0.075);\n    this.scale *= normalized;\n    this.scale = Math.min(Math.max(this.scale, 0.25), 2);\n    // Redraw\n    this.draw();\n  }\n\n  onResize() {\n    // Resize the canvas\n    const { dom: { current: canvas } } = this;\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n    // Redraw\n    this.draw();\n  }\n\n  getPointer([x, y]) {\n    // Convert coordinates from screen-space to room-space\n    const { dom: { current: canvas }, origin, scale } = this;\n    return {\n      x: ((x - (canvas.width * 0.5)) / scale) - origin.x,\n      y: ((y - (canvas.height * 0.5)) / scale) - origin.y,\n    };\n  }\n\n  loadPhotos({ photos }) {\n    // Go through all the photos in the redux state\n    photos.forEach(({ _id, photo }) => {\n      // If it's not already in the cache, load it as an Image object\n      if (!this.photos[_id]) {\n        const img = new Image();\n        img.src = `data:image/jpeg;base64,${photo}`;\n        img.onload = () => (\n          // Redraw once it's loaded into the cache\n          this.draw()\n        );\n        this.photos[_id] = img;\n      }\n    });\n  }\n\n  draw(props) {\n    const { dom: { current: canvas }, origin, scale } = this;\n    const { name, photos } = props || this.props;\n    const ctx = canvas.getContext('2d');\n    // Reset canvas context\n    canvas.width = canvas.width;\n    // Room-space coordinates start at the middle of the canvas\n    ctx.translate(canvas.width * 0.5, canvas.height * 0.5);\n    // Apply user scale\n    ctx.scale(scale, scale);\n    // Apply user translation\n    ctx.translate(origin.x, origin.y);\n    // Draw room name at 0,0\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillStyle = '#999';\n    ctx.font = '32px Arial';\n    ctx.fillText(I18n.t(`Room.${name ? 'welcome' : 'joining'}`, { name }), 0, 0);\n    // Go through all the photos in the redux state\n    photos.forEach(({ _id, origin }) => {\n      // Check the cache to see if the photo has been\n      // already loaded as an Image object by \"loadPhotos\"\n      if (this.photos[_id]) {\n        // Draw the cached Image object\n        ctx.drawImage(this.photos[_id], origin.x, origin.y);\n      }\n    });\n  }\n\n  render() {\n    const { dom } = this;\n    return (\n      <canvas ref={dom} />\n    );\n  }\n}\n\nCanvas.propTypes = {\n  // eslint-disable-next-line react/no-unused-prop-types\n  name: PropTypes.string.isRequired,\n  photos: PropTypes.arrayOf(PropTypes.shape({\n    origin: PropTypes.shape({\n      x: PropTypes.number.isRequired,\n      y: PropTypes.number.isRequired,\n    }),\n    photo: PropTypes.string.isRequired,\n  })).isRequired,\n  socket: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]).isRequired,\n};\n\nexport default connect(\n  ({ room: { name, photos, socket } }) => ({ name, photos, socket })\n)(Canvas);\n","import PropTypes from 'prop-types';\nimport { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { hideLoading, showLoading } from 'react-redux-loading-bar';\nimport WebSocket from 'reconnecting-websocket';\nimport Peer from 'simple-peer';\nimport {\n  addPhoto,\n  join,\n  movePhoto,\n  removePhoto,\n  reset,\n  peerJoin,\n  peerLeave,\n  peerSignal,\n  peerStream,\n  startStream,\n} from '@/actions/room';\nimport * as types from '@/actions/types';\nimport API from '@/services/api';\n\nclass Events extends Component {\n  constructor(props) {\n    super(props);\n    this.onMessage = this.onMessage.bind(this);\n  }\n\n  componentWillMount() {\n    const {\n      slug,\n      hideLoading,\n      showLoading,\n      startStream,\n    } = this.props;\n\n    // Connect to room server\n    showLoading();\n    this.socket = new WebSocket(\n      `${API.baseURL.replace(/http/, 'ws')}room/${slug}`,\n      API.token\n    );\n    this.socket.onopen = () => {\n      this.socket.onclose = null;\n      this.socket.onerror = null;\n      hideLoading();\n    };\n    this.socket.onmessage = this.onMessage;\n\n    // Open audio+video stream\n    navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: {\n        facingMode: 'user',\n        width: 640,\n        height: 640,\n      },\n    })\n      .then(startStream)\n      .catch(() => {\n        // Failed to get video stream.. Try with just audio\n        navigator.mediaDevices.getUserMedia({\n          audio: true,\n          video: false,\n        })\n          .then(startStream)\n          .catch(() => {});\n      });\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  componentWillUnmount() {\n    const { socket } = this;\n    const { hideLoading, reset } = this.props;\n    if (socket.readyState === WebSocket.CONNECTING) {\n      hideLoading();\n    }\n    socket.close(1000);\n    reset();\n  }\n\n  onMessage({ data }) {\n    const { socket } = this;\n    const {\n      addPhoto,\n      join,\n      movePhoto,\n      peerJoin,\n      peerLeave,\n      peerSignal,\n      removePhoto,\n    } = this.props;\n    let event;\n    try {\n      event = JSON.parse(data);\n    } catch (e) {\n      return;\n    }\n    switch (event.type) {\n      case types.ROOM_ADD_PHOTO:\n        addPhoto(event.payload);\n        break;\n      case types.ROOM_MOVE_PHOTO:\n        movePhoto(event.payload);\n        break;\n      case types.ROOM_REMOVE_PHOTO:\n        removePhoto(event.payload);\n        break;\n      case types.ROOM_JOIN:\n        join({\n          ...event.payload,\n          peers: event.payload.peers.map(peer => this.connectToPeer(peer, true)),\n          socket,\n        });\n        break;\n      case types.ROOM_PEER_JOIN:\n        peerJoin(this.connectToPeer(event.payload));\n        break;\n      case types.ROOM_PEER_LEAVE:\n        peerLeave(event.payload);\n        break;\n      case types.ROOM_PEER_SIGNAL:\n        peerSignal(event.payload);\n        break;\n      default:\n        break;\n    }\n  }\n\n  connectToPeer(peer, initiator = false) {\n    const { socket } = this;\n    const { stream, peerStream } = this.props;\n    peer.connection = new Peer({\n      initiator,\n      stream,\n    });\n    peer.connection.on('signal', (signal) => {\n      socket.send(JSON.stringify({\n        type: 'ROOM/PEER_SIGNAL',\n        payload: {\n          peer: peer.peer,\n          signal,\n        },\n      }));\n    });\n    peer.connection.on('stream', stream => (\n      peerStream({ peer: peer.peer, stream })\n    ));\n    return peer;\n  }\n\n  render() {\n    return null;\n  }\n}\n\nEvents.propTypes = {\n  slug: PropTypes.string.isRequired,\n  stream: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]).isRequired,\n  addPhoto: PropTypes.func.isRequired,\n  hideLoading: PropTypes.func.isRequired,\n  join: PropTypes.func.isRequired,\n  movePhoto: PropTypes.func.isRequired,\n  removePhoto: PropTypes.func.isRequired,\n  reset: PropTypes.func.isRequired,\n  peerJoin: PropTypes.func.isRequired,\n  peerLeave: PropTypes.func.isRequired,\n  peerSignal: PropTypes.func.isRequired,\n  peerStream: PropTypes.func.isRequired,\n  showLoading: PropTypes.func.isRequired,\n  startStream: PropTypes.func.isRequired,\n};\n\nexport default connect(\n  ({ room: { stream } }) => ({ stream }),\n  {\n    addPhoto,\n    hideLoading,\n    join,\n    movePhoto,\n    removePhoto,\n    reset,\n    peerJoin,\n    peerLeave,\n    peerSignal,\n    peerStream,\n    showLoading,\n    startStream,\n  }\n)(Events);\n","import * as types from './types';\n\nexport function addPhoto({ _id, origin, photo }) {\n  return {\n    type: types.ROOM_ADD_PHOTO,\n    payload: { _id, origin, photo },\n  };\n}\n\nexport function movePhoto({ origin, photo }) {\n  return {\n    type: types.ROOM_MOVE_PHOTO,\n    payload: { origin, photo },\n  };\n}\n\nexport function join({\n  name,\n  peers,\n  photos,\n  socket,\n}) {\n  return {\n    type: types.ROOM_JOIN,\n    payload: {\n      name,\n      peers,\n      photos,\n      socket,\n    },\n  };\n}\n\nexport function peerJoin(peer) {\n  return {\n    type: types.ROOM_PEER_JOIN,\n    payload: { peer },\n  };\n}\n\nexport function peerLeave({ peer }) {\n  return {\n    type: types.ROOM_PEER_LEAVE,\n    payload: { peer },\n  };\n}\n\nexport function peerSignal({ peer, signal }) {\n  return {\n    type: types.ROOM_PEER_SIGNAL,\n    payload: { peer, signal },\n  };\n}\n\nexport function peerStream({ peer, stream }) {\n  return {\n    type: types.ROOM_PEER_STREAM,\n    payload: { peer, stream },\n  };\n}\n\nexport function removePhoto({ photo }) {\n  return {\n    type: types.ROOM_REMOVE_PHOTO,\n    payload: { photo },\n  };\n}\n\nexport function reset() {\n  return {\n    type: types.ROOM_RESET,\n  };\n}\n\nexport function startStream(stream) {\n  return {\n    type: types.ROOM_STREAM_START,\n    payload: { stream },\n  };\n}\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport styled from 'styled-components';\nimport API from '@/services/api';\nimport Video from './video';\n\nconst Listing = styled.div`\n  position: absolute;\n  top: 100px;\n  right: 0;\n  > img, > div > video {\n    display: block;\n    background: #000;\n    width: 100px;\n    height: 100px;\n    vertical-align: middle;\n    box-shadow: 0 0 10px rgba(0, 0, 0, .5);\n  }\n`;\n\nconst Peers = ({ peers }) => (\n  <Listing>\n    {peers.map(({\n      _id,\n      name,\n      peer,\n      video,\n    }) => (\n      video && video.srcObject.getVideoTracks().length ? (\n        <Video\n          key={peer}\n          video={video}\n        />\n      ) : (\n        <img\n          key={peer}\n          alt={name}\n          src={`${API.baseURL}user/${_id}/photo?auth=${API.token}`}\n        />\n      )\n    ))}\n  </Listing>\n);\n\nPeers.propTypes = {\n  peers: PropTypes.arrayOf(PropTypes.shape({\n    name: PropTypes.string.isRequired,\n    peer: PropTypes.string.isRequired,\n    video: PropTypes.object,\n  })).isRequired,\n};\n\nexport default connect(\n  ({\n    room: { peers },\n  }) => ({\n    peers,\n  })\n)(Peers);\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport Canvas from '@/components/room/canvas';\nimport Events from '@/components/room/events';\nimport Peers from '@/components/room/peers';\n\nconst Room = ({ match: { params: { slug } } }) => (\n  <div>\n    <Canvas />\n    <Events slug={slug} />\n    <Peers />\n  </div>\n);\n\nRoom.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      slug: PropTypes.string.isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n\nexport default Room;\n","import PropTypes from 'prop-types';\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { Translate } from 'react-redux-i18n';\nimport { Link } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { fetch } from '@/actions/rooms';\n\nconst Listing = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 512px;\n  margin: 0 auto;\n  background: #fff;\n  > a {\n    display: flex;\n    box-sizing: border-box;\n    width: 100%;\n    align-items: center;\n    justify-content: space-between;\n    font-size: 1.5em;\n    padding: 0.5rem 1rem;\n    color: #000;\n    text-decoration: none;\n    &:hover {\n      background: #bbb;\n    }\n  }\n  > h1 {\n    box-sizing: border-box;\n    width: 100%;\n    margin: 0 0 1rem;\n    padding: 1rem;\n    border-bottom: 1px solid #aaa;\n  }\n`;\n\nclass Rooms extends PureComponent {\n  componentDidMount() {\n    const { fetch } = this.props;\n    fetch();\n  }\n\n  render() {\n    const { list } = this.props;\n    return (\n      <Listing>\n        <h1>Rooms</h1>\n        {list.map(({ name, peers, slug }) => (\n          <Link\n            key={slug}\n            to={{ pathname: `r/${slug}` }}\n          >\n            <strong>\n              {name}\n            </strong>\n            <Translate\n              count={peers}\n              value=\"Rooms.peers\"\n            />\n          </Link>\n        ))}\n      </Listing>\n    );\n  }\n}\n\nRooms.propTypes = {\n  list: PropTypes.arrayOf(PropTypes.shape({\n    name: PropTypes.string.isRequired,\n    peers: PropTypes.number.isRequired,\n    slug: PropTypes.string.isRequired,\n  })).isRequired,\n  fetch: PropTypes.func.isRequired,\n};\n\nexport default connect(\n  ({\n    rooms: { list },\n  }) => ({\n    list,\n  }),\n  {\n    fetch,\n  }\n)(Rooms);\n","import API from '@/services/api';\nimport * as types from './types';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function fetch() {\n  return {\n    type: types.ROOMS_FETCH,\n    payload: API.fetch({\n      endpoint: 'rooms',\n    }),\n  };\n}\n","import styled from 'styled-components';\n\nexport default styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.5rem 1rem;\n  margin: 0;\n  background-color: ${props => (props.primary ? '#eee' : '#333')};\n  color: ${props => (props.primary ? '#333' : '#eee')};\n  border: 1px solid #151515;\n  border-radius: 2px;\n  outline: 0;\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 700;\n  transition: background-color ease-out .2s, opacity ease-out .2s;\n  will-change: background-color, opacity;\n  cursor: pointer;\n  > span {\n    margin-left: 0.5rem;\n  }\n  &:hover {\n    background-color: ${props => (props.primary ? '#fff' : '#555')};\n  }\n`;\n","import PropTypes from 'prop-types';\nimport React, { PureComponent } from 'react';\nimport { TiSocialGooglePlus } from 'react-icons/ti';\nimport { connect } from 'react-redux';\nimport { Translate } from 'react-redux-i18n';\nimport styled from 'styled-components';\nimport { refresh } from '@/actions/session';\nimport Button from '@/components/ui/button';\nimport API from '@/services/api';\n\nconst Wrapper = styled.div`\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Box = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  background: #bebebe;\n  border: 1px solid #000;\n  padding: 3rem 6rem;\n  > button {\n    width: 100%;\n    font-size: 1rem;\n    align-items: center;\n    justify-content: flex-start;\n    > svg {\n      font-size: 2rem;\n      margin-right: 0.75rem;\n    }\n  }\n`;\n\nclass Login extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.loginWithGoogle = this.loginWithGoogle.bind(this);\n    this.onMessage = this.onMessage.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('message', this.onMessage, false);\n  }\n\n  componentWillUnmount() {\n    const { popupWatcher } = this;\n    window.removeEventListener('message', this.onMessage);\n    if (popupWatcher) {\n      clearInterval(popupWatcher);\n      delete this.popupWatcher;\n    }\n  }\n\n  onMessage({ origin, data: { session } }) {\n    const { popupWatcher } = this;\n    const { refresh } = this.props;\n    if (API.baseURL.indexOf(origin) === 0) {\n      clearInterval(popupWatcher);\n      delete this.popupWatcher;\n      if (session) {\n        refresh(session);\n      }\n    }\n  }\n\n  loginWithGoogle({ screenX, screenY }) {\n    const w = 512;\n    const h = 512;\n    const left = (screenX || (window.screen.width / 2)) - (w / 2);\n    const top = (screenY || (window.screen.height / 2)) - (h / 2);\n    const win = window.open(\n      `${API.baseURL}user/google`,\n      'loginWithGoogle',\n      `width=${w},height=${h},top=${top},left=${left}`\n    );\n    if (this.popupWatcher) {\n      clearInterval(this.popupWatcher);\n    }\n    this.popupWatcher = setInterval(() => {\n      if (!win.window) {\n        clearInterval(this.popupWatcher);\n        delete this.popupWatcher;\n        return;\n      }\n      win.postMessage(true, API.baseURL);\n    }, 100);\n  }\n\n  render() {\n    return (\n      <Wrapper>\n        <Box>\n          <Button\n            type=\"button\"\n            onClick={this.loginWithGoogle}\n          >\n            <TiSocialGooglePlus />\n            <Translate value=\"User.signIn\" />\n          </Button>\n        </Box>\n      </Wrapper>\n    );\n  }\n}\n\nLogin.propTypes = {\n  refresh: PropTypes.func.isRequired,\n};\n\nexport default connect(\n  () => ({}),\n  {\n    refresh,\n  }\n)(Login);\n","import PropTypes from 'prop-types';\nimport React from 'react';\nimport { TiArrowBack } from 'react-icons/ti';\nimport { Translate } from 'react-redux-i18n';\nimport { Link } from 'react-router-dom';\nimport styled from 'styled-components';\nimport Button from '@/components/ui/button';\n\nconst Wrapper = styled.div`\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst Status = styled.div`\n  font-size: 6em;\n  line-height: 0.8em;\n  color: #656565;\n  margin-bottom: 2rem;\n`;\n\nconst Description = styled.div`\n  font-size: 1.5em;\n`;\n\nconst Alternative = styled.div`\n  margin: 2rem 0 4rem;\n  > a {\n    text-decoration: none;\n    font-size: 1.2em;\n  }\n`;\n\nconst NotFound = ({ location: { state } }) => {\n  const from = state && state.from;\n  return (\n    <Wrapper>\n      <Status>\n        404\n      </Status>\n      <Description>\n        <Translate value={`NotFound.${from || 'default'}Route`} />\n      </Description>\n      <Alternative>\n        <Link to={{ pathname: `/${from || ''}` }}>\n          <Button\n            type=\"button\"\n            primary\n          >\n            <TiArrowBack />\n            <Translate value=\"NotFound.goBack\" />\n          </Button>\n        </Link>\n      </Alternative>\n    </Wrapper>\n  );\n};\n\nNotFound.propTypes = {\n  location: PropTypes.shape({\n    state: PropTypes.shape({\n      route: PropTypes.string,\n    }),\n  }).isRequired,\n};\n\nexport default NotFound;\n","import React from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\nimport { Route as RouteComponent, Redirect, Switch } from 'react-router-dom';\nimport Layout from '@/layout';\nimport Room from './room';\nimport Rooms from './rooms';\nimport Login from './login';\nimport NotFound from './404';\n\nconst Route = connect(\n  ({ session: { isAuth } }) => ({ isAuth })\n)(({\n  component: Component,\n  isAuth,\n  requiresAuth,\n  requiresNoAuth,\n  ...rest\n}) => {\n  const isForbidden = (\n    (requiresAuth && !isAuth)\n    || (requiresNoAuth && isAuth)\n  );\n  return (\n    <RouteComponent\n      {...rest}\n      render={props => (\n        (isForbidden) ? (\n          <Redirect to={isAuth ? '/' : '/login'} />\n        ) : (\n          <Component {...props} />\n        )\n      )}\n    />\n  );\n});\n\nconst Root = () => (\n  <Layout>\n    <Switch>\n      <Redirect exact from=\"/\" to=\"/rooms\" />\n      <Route exact path=\"/(r|room)/:slug\" component={Room} requiresAuth />\n      <Route exact path=\"/rooms\" component={Rooms} requiresAuth />\n      <Route exact path=\"/login\" component={Login} requiresNoAuth />\n      <Route path=\"*\" component={NotFound} />\n    </Switch>\n  </Layout>\n);\n\nexport default hot(module)(Root);\n","import { createBrowserHistory, createHashHistory } from 'history';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { applyMiddleware, createStore, compose as productionCompose } from 'redux';\nimport promiseMiddleware from 'redux-promise-middleware';\nimport { Provider } from 'react-redux';\nimport { loadingBarMiddleware } from 'react-redux-loading-bar';\nimport { Router } from 'react-router-dom';\nimport thunkMiddleware from 'redux-thunk';\nimport { refresh as refreshToken } from '@/actions/session';\nimport syncTranslationWithStore, { load as reloadLocales } from '@/locales';\nimport rootReducer from '@/reducers';\nimport Root from '@/routes';\n\nconst devCompose = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;\nconst compose = !__PRODUCTION__ && devCompose ? devCompose : productionCompose;\nconst store = createStore(\n  rootReducer,\n  {},\n  compose(\n    applyMiddleware(thunkMiddleware, promiseMiddleware, loadingBarMiddleware())\n  )\n);\nsyncTranslationWithStore(store);\n\nif (store.getState().session.isAuth) {\n  store.dispatch(refreshToken());\n}\n\nlet history;\nif (window.process && window.process.type) {\n  history = createHashHistory();\n} else {\n  history = createBrowserHistory({\n    basename: __BASENAME__,\n  });\n}\n\nconst mount = document.getElementById('mount');\nrender(\n  <Provider store={store}>\n    <Router history={history}>\n      <Root />\n    </Router>\n  </Provider>,\n  mount\n);\n\nwindow.addEventListener('contextmenu', e => (\n  e.preventDefault()\n), false);\n\nif (!__PRODUCTION__ && module.hot) {\n  module.hot.accept('@/locales', () => reloadLocales(store));\n  module.hot.accept('@/reducers', () => store.replaceReducer(rootReducer));\n}\n"],"sourceRoot":""}